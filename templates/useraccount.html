<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Corner | Account</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='account.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Quicksand:wght@300;400;700&display=swap" rel="stylesheet">

</head>

<body>

    <div class="mainnavbar">
        
        <nav class="navbar navbar-expand-lg navbar-light bg-light" id="Homepage">
            <a class="navbar-brand" href="{{ url_for('show_products')}}">
                <img src="{{ url_for('static', filename='images/petcornerlogo2.png') }}" width="220px"
                    alt="Pet Corner Logo">
            </a>
            <div class="navbar-collapse collapse show" id="navbarNav">

                <!-- Search Bar -->
                <form class="form-inline my-2 my-lg-0 mx-auto custom-search">
                    <div class="input-group">
                        <input class="form-control" type="search" id="search" name="search" placeholder="Search here..">
                        <div class="input-group-append">
                            <span class="input-group-text" id="search-icon">
                                <img src="{{ url_for('static', filename='images/search.svg') }}" width="25px"
                                    alt="Search Icon">
                            </span>
                        </div>
                    </div>
                </form>
                <!-- Nav Icons -->
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><a class="nav-link" href="#"><img
                                src="{{ url_for('static', filename='images/bell-solid.svg') }}" width="25px"
                                alt="notification"></a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><img
                                src="{{ url_for('static', filename='images/cart-solid.svg') }}" width="28px" alt="cart"></a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('account')}}"><img
                                src="{{ url_for('static', filename='images/user-solid.svg') }}" width="23px"
                                alt="Account"></a></li>
                    <li class="nav-item"><a class="nav-link" href="{{url_for('logout')}}" onclick="confirmLogout(event);">
                        <img src="{{ url_for('static', filename='images/logout-solid.svg') }}" width="23px" alt="logout"></a>
                    </li>
            

                </ul>
            </div>
        </nav>

        <!-- Nav Sub Buttons -->
        <div class="NavSubButtons">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="{{ url_for('show_products')}}" id="homebtn">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('show_products')}}" id="productsbtn" >Products</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('show_products')}}" id="categoriesbtn">Categories</a></li>
            </ul>
        </div>

    </div>

    <div class="accountdetails">

        <div class="container mt-5">
            <div class="profile">
                <div class="profile-header text-center">
                    <div class="profile-image">
                        <img id="profile-pic" src="{{ url_for('static', filename='images/noprof.png') }}" alt="Profile Picture" class="rounded-circle" width="150" height="150" style="cursor: pointer;">
                        <input type="file" id="upload-photo" accept="image/*" style="display: none;">
                    </div>
                    <h2 class="username">Username</h2>
                    <p class="email">user@example.com</p>
                    <button class="btn btn-primary" id="edit-profile-btn">Edit Profile</button>
                </div>
    
                <div class="profile-tabs mt-4">
                    <ul class="nav nav-pills justify-content-center">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#addresses">My Address</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#settings">Settings</a>
                        </li>
                    </ul>
                </div>
    
                <div class="tab-content mt-4">
                    <div id="addresses" class="tab-pane fade show active">
                        <h4>Saved Address</h4>
                        <div id="address-display" class="border p-3 mb-3">
                            <p id="address-text">Region, Province, City, Barangay</p>
                            <button class="btn btn-warning" id="edit-address-btn">Edit Address</button>
                            <button class="btn btn-danger" id="delete-address-btn">Delete Address</button>
                        </div>
    
                        <form id="edit-address-form" style="display: none;">
                            <div class="form-group">
                                <label for="new-region">Region</label>
                                <input type="text" class="form-control" id="new-region" required>
                            </div>
                            <div class="form-group">
                                <label for="new-province">Province</label>
                                <input type="text" class="form-control" id="new-province" required>
                            </div>
                            <div class="form-group">
                                <label for="new-city">City</label>
                                <input type="text" class="form-control" id="new-city" required>
                            </div>
                            <div class="form-group">
                                <label for="new-barangay">Barangay</label>
                                <input type="text" class="form-control" id="new-barangay" required>
                            </div>
                            <button type="submit" class="btn btn-success">Save Address</button>
                            <button type="button" class="btn btn-secondary" id="cancel-edit-btn">Cancel</button>
                        </form>
                    </div>
    
                    <div id="settings" class="tab-pane fade">
                        <h4>Account Settings</h4>
                        <form id="settings-form">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" class="form-control" id="username" value="Username" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" class="form-control" id="email" value="user@example.com" required>
                            </div>
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" class="form-control" id="password" placeholder="Change Password">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <!-- Bootstrap JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>

        function confirmLogout(event) {
            event.preventDefault();  
            if (confirm("Are you sure you want to log out?")) {
                    window.location.href = "{{ url_for('logout') }}"; 
            }
      
        }
            
    </script>

    <script>
        // Load saved address and settings from localStorage
        window.onload = function() {
            const savedAddress = localStorage.getItem('address');
            if (savedAddress) {
                document.getElementById('address-text').textContent = savedAddress;
            }

            const savedUsername = localStorage.getItem('username');
            const savedEmail = localStorage.getItem('email');
            if (savedUsername) {
                document.getElementById('username').value = savedUsername;
                document.querySelector('.username').textContent = savedUsername;
            }
            if (savedEmail) {
                document.getElementById('email').value = savedEmail;
                document.querySelector('.email').textContent = savedEmail;
            }
        };

        document.getElementById('profile-pic').addEventListener('click', function () {
            document.getElementById('upload-photo').click();
        });

        document.getElementById('upload-photo').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const confirmUpload = confirm("Are you sure you want to upload this picture?");
                if (confirmUpload) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('profile-pic').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    event.target.value = "";
                }
            }
        });

        document.getElementById('edit-address-btn').addEventListener('click', function () {
            document.getElementById('address-display').style.display = 'none';
            document.getElementById('edit-address-form').style.display = 'block';
            const currentAddress = document.getElementById('address-text').textContent.split(', ');
            if (currentAddress.length === 4) {
                document.getElementById('new-region').value = currentAddress[0];
                document.getElementById('new-province').value = currentAddress[1];
                document.getElementById('new-city').value = currentAddress[2];
                document.getElementById('new-barangay').value = currentAddress[3];
            }
        });

        document.getElementById('edit-address-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const region = document.getElementById('new-region').value;
            const province = document.getElementById('new-province').value;
            const city = document.getElementById('new-city').value;
            const barangay = document.getElementById('new-barangay').value;

            const newAddress = `${region}, ${province}, ${city}, ${barangay}`;
            document.getElementById('address-text').textContent = newAddress;

            localStorage.setItem('address', newAddress);

            document.getElementById('edit-address-form').style.display = 'none';
            document.getElementById('address-display').style.display = 'block';
        });

        document.getElementById('delete-address-btn').addEventListener('click', function () {
            if (confirm("Are you sure you want to delete this address?")) {
                document.getElementById('address-text').textContent = "No saved address.";
                localStorage.removeItem('address');
                document.getElementById('address-display').style.display = 'none';
            }
        });

        document.getElementById('cancel-edit-btn').addEventListener('click', function () {
            document.getElementById('edit-address-form').reset();
            document.getElementById('edit-address-form').style.display = 'none';
            document.getElementById('address-display').style.display = 'block';
        });

        document.getElementById('edit-profile-btn').addEventListener('click', function () {
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            document.getElementById('username').disabled = false;
            document.getElementById('email').disabled = false;
            this.textContent = 'Save Profile';
            this.id = 'save-profile-btn';
            this.removeEventListener('click', arguments.callee);

            document.getElementById('save-profile-btn').addEventListener('click', function () {
                const newUsername = document.getElementById('username').value;
                const newEmail = document.getElementById('email').value;

                document.querySelector('.username').textContent = newUsername;
                document.querySelector('.email').textContent = newEmail;

                localStorage.setItem('username', newUsername);
                localStorage.setItem('email', newEmail);
                
                this.textContent = 'Edit Profile';
                this.id = 'edit-profile-btn';
                document.getElementById('username').disabled = true;
                document.getElementById('email').disabled = true;
            });
        });

        document.getElementById('settings-form').addEventListener('submit', function (e) {
            e.preventDefault();
            
            const password = document.getElementById('password').value;

            alert(`Changes saved:\nPassword: ${password ? 'Updated' : 'Not changed'}`);
            this.reset();
        });
    </script>

</body>

</html>